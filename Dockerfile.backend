FROM node:18-alpine AS builder
WORKDIR /app
COPY backend ./backend
WORKDIR /app/backend
RUN npm install
RUN npx nx run-many --target=build --all

FROM node:18-alpine AS runner
WORKDIR /app
COPY --from=builder /app/backend/dist ./dist
COPY backend/package.json .
# The entrypoint is overridden by docker-compose `command`
